{{- /*
Renders a menu for the given menu ID.
*/}}

{{- $page := .page }}
{{- $menuID := .menuID }}

{{- with index site.Menus $menuID }}
<nav class="site-nav" role="navigation" aria-label="Hoofdmenu">
  <ul class="site-nav__list">
    {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
  </ul>
</nav>
{{- end }}

{{- define "_partials/inline/menu/walk.html" }}
{{- $page := .page }}
{{- range .menuEntries }}
{{- $hasChildren := .Children }}
{{- $isActive := or ($page.IsMenuCurrent .Menu .) ($page.HasMenuCurrent .Menu .) }}
{{- $name := .Name }}
{{- $submenuID := printf "submenu-%s" (.Identifier | default .Name | urlize) }}

{{- if $hasChildren }}
<li class="has-submenu">
  <span class="link--wrapped" {{ if $isActive }} aria-current="page" {{ end }} aria-expanded="false">
    <a class="site-nav__link" href="{{ .URL }}">{{ $name }}</a>
    <button aria-haspopup="true" aria-label="toggle menu" aria-expanded="false" aria-controls="{{ $submenuID }}"
      aria-label="Toon submenu voor {{ $name }}" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none">
        <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </button>
  </span>

  <ul id="{{ $submenuID }}" class="submenu" hidden>
    {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .Children) }}
  </ul>
</li>
{{- else }}
<li>
  <a class="site-nav__link" href="{{ .URL }}" {{ if $isActive }} aria-current="page" {{ end }} aria-expanded="false">{{
    $name }}</a>
</li>
{{- end }}
{{- end }}
{{- end }}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const items = document.querySelectorAll("li.has-submenu");

    function closeAllSubmenus(except = null) {
      items.forEach((item) => {
        if (item !== except && item.classList.contains("open")) {
          const submenu = item.querySelector("ul.submenu");
          const btn = item.querySelector("button");
          const link = item.querySelector("a");

          item.classList.remove("open");
          submenu.hidden = true;
          btn.setAttribute("aria-expanded", "false");
          link.setAttribute("aria-expanded", "false");
        }
      });
    }

    items.forEach((item) => {
      const btn = item.querySelector("button");
      const submenu = item.querySelector("ul.submenu");
      const link = item.querySelector("a");

      // Alleen via klik openen/sluiten
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        const isOpen = item.classList.contains("open");

        if (isOpen) {
          // Sluit submenu
          item.classList.remove("open");
          submenu.hidden = true;
          btn.setAttribute("aria-expanded", "false");
          link.setAttribute("aria-expanded", "false");
        } else {
          // Sluit eerst andere submenu's
          closeAllSubmenus(item);

          // Open submenu
          item.classList.add("open");
          submenu.hidden = false;
          btn.setAttribute("aria-expanded", "true");
          link.setAttribute("aria-expanded", "true");
        }
      });

      // Initieel submenu verbergen
      submenu.hidden = !item.classList.contains("open");
    });
  });
</script>