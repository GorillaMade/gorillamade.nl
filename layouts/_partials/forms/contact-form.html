<div x-data="{ 
  terugbel: false,
  dagen: ['Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrijdag', 'Zaterdag'],
  geselecteerdeDagen: {}
}" class="form-card flow">

  <form id="contact-form" class="flow" hx-post="/send" hx-target="#form-response" hx-swap="innerHTML"
    onsubmit="return validateContactForm(this)">
    
    <div class="grid">
      <div class="field-group">
        <label for="naam">Naam</label>
        <input id="naam" type="text" name="naam" placeholder="Uw naam" />
      </div>
      <div class="field-group">
        <label for="email">E-mail</label>
        <input id="email" type="email" name="email" placeholder="Uw e-mailadres" />
      </div>
    </div>

    <div class="field-group">
      <label for="bericht">Uw bericht</label>
      <textarea id="bericht" name="bericht" rows="4" placeholder="Uw bericht"></textarea>
    </div>

    <label class="flex-group">
      <input type="checkbox" name="terugbel" x-model="terugbel" />
      <span>Ik wil graag teruggebeld worden</span>
    </label>

    <div class="flow" x-show="terugbel" x-transition>
      <div class="field-group">
        <label for="tel">Telefoon nr.</label>
        <input id="tel" type="tel" name="telefoon" placeholder="Telefoonnummer" :required="terugbel" />
      </div>

      <!-- Directe loop zonder template -->
      <div class="field-group flow" x-for="dag in dagen" :key="dag">
        <label class="flex-group">
          <input type="checkbox" :value="dag" x-model="geselecteerdeDagen[dag]" />
          <span x-text="dag"></span>
        </label>

        <div class="terugbellen flex-group flex-group--between" x-show="geselecteerdeDagen[dag]" x-transition>
          <input type="time" :name="`tijd_van[${dag}]`" />
          <span>tot</span>
          <input type="time" :name="`tijd_tot[${dag}]`" />
        </div>
      </div>
    </div>

    <input type="hidden" name="_form" value="contact" />
    <input type="hidden" name="_subject" value="Contactformulier website" />

    <div>
      <button type="submit" class="button" data-button-variant="primary">Verzend</button>
    </div>
  </form>

  <div id="form-response"></div>
</div>

<script>
  function showError(message) {
    const responseDiv = document.getElementById('form-response');
    responseDiv.innerHTML = `<div class="form-error">${message}</div>`;
    responseDiv.scrollIntoView({ behavior: 'smooth' });
  }

  function clearError() {
    document.getElementById('form-response').innerHTML = '';
  }

  function validateContactForm(form) {
    clearError();

    const naam = form.querySelector('[name="naam"]');
    const email = form.querySelector('[name="email"]');
    const terugbel = form.querySelector('[name="terugbel"]').checked;
    const telefoon = form.querySelector('[name="telefoon"]');

    if (!naam.value.trim()) {
      showError("Vul uw naam in.");
      naam.focus();
      return false;
    }

    if (!email.value.trim() || !email.validity.valid) {
      showError("Voer een geldig e-mailadres in.");
      email.focus();
      return false;
    }

    if (terugbel && !telefoon.value.trim()) {
      showError("Vul uw telefoonnummer in.");
      telefoon.focus();
      return false;
    }

    return true;
  }
</script>
